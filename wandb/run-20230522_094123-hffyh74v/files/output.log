[2023-05-22 09:41:26,385, ema.py:67] EMA smoothing ENABLED: 0.99
[2023-05-22 09:41:29,769, data_pipeline.py:49] Imported 101_20200102_merge.csv.xz from a csv in 3 seconds
[2023-05-22 09:41:30,008, ema.py:93] Applying EMA to data...
[2023-05-22 09:41:32,289, data_pipeline.py:49] Imported /XBTUSD_2020-01-03.csv.xz from a csv in 1 seconds
[2023-05-22 09:41:32,503, ema.py:93] Applying EMA to data...
[2023-05-22 09:41:32,754, data_pipeline.py:228] Adding order imbalances...
[2023-05-22 09:41:32,776, ema.py:127] Reset EMA data.
[2023-05-22 09:41:32,777, ema.py:93] Applying EMA to data...
[2023-05-22 09:41:32,978, ema.py:67] EMA smoothing ENABLED: 0.99
[2023-05-22 09:41:32,978, ema.py:67] EMA smoothing ENABLED: 0.99
[2023-05-22 09:41:32,978, ema.py:67] EMA smoothing ENABLED: 0.99
[2023-05-22 09:41:32,978, ema.py:67] EMA smoothing ENABLED: 0.99
Resetting environment #1 on episode #0.
market-maker-v0 XBTUSD #1 instantiated
observation_space: (100, 174) reward_type = TRADE_COMPLETION max_steps = 86345
Using cpu device
Resetting environment #1 on episode #0.
Logging to ./runs/hffyh74v/DQN_1
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -365.9970
Episode PnL: -2.24%
Trade Count: 1678
Average PnL per Trade: -0.0133%
Total # of episodes: 1
short_inventory_market_orders	=	353
short_inventory_orders_placed	=	580
short_inventory_orders_updated	=	9758
short_inventory_orders_executed	=	579
long_inventory_market_orders	=	260
long_inventory_orders_placed	=	487
long_inventory_orders_updated	=	9876
long_inventory_orders_executed	=	486
First step:	5192
===========================================================================
----------------------------------------
| logger/                  |           |
|    episode_avg_trade_pnl | -0.000133 |
|    episode_pnl           | -2.23     |
|    episode_reward        | -365      |
| rollout/                 |           |
|    ep_len_mean           | 1.46e+04  |
|    ep_rew_mean           | -366      |
|    exploration_rate      | 0.722     |
| time/                    |           |
|    episodes              | 1         |
|    fps                   | 2234      |
|    time_elapsed          | 6         |
|    total_timesteps       | 14635     |
----------------------------------------
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -413.9886
Episode PnL: -2.65%
Trade Count: 1820
Average PnL per Trade: -0.0145%
Total # of episodes: 2
short_inventory_market_orders	=	347
short_inventory_orders_placed	=	597
short_inventory_orders_updated	=	10695
short_inventory_orders_executed	=	596
long_inventory_market_orders	=	314
long_inventory_orders_placed	=	564
long_inventory_orders_updated	=	10715
long_inventory_orders_executed	=	563
First step:	10955
===========================================================================
----------------------------------------
| logger/                  |           |
|    episode_avg_trade_pnl | -0.000145 |
|    episode_pnl           | -2.65     |
|    episode_reward        | -414      |
| rollout/                 |           |
|    ep_len_mean           | 1.53e+04  |
|    ep_rew_mean           | -390      |
|    exploration_rate      | 0.417     |
| time/                    |           |
|    episodes              | 2         |
|    fps                   | 2429      |
|    time_elapsed          | 12        |
|    total_timesteps       | 30666     |
----------------------------------------
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -385.9816
Episode PnL: -1.20%
Trade Count: 1722
Average PnL per Trade: -0.0070%
Total # of episodes: 3
short_inventory_market_orders	=	345
short_inventory_orders_placed	=	593
short_inventory_orders_updated	=	10034
short_inventory_orders_executed	=	592
long_inventory_market_orders	=	269
long_inventory_orders_placed	=	517
long_inventory_orders_updated	=	10062
long_inventory_orders_executed	=	516
First step:	7813
===========================================================================
----------------------------------------
| logger/                  |           |
|    episode_avg_trade_pnl | -6.97e-05 |
|    episode_pnl           | -1.2      |
|    episode_reward        | -386      |
| rollout/                 |           |
|    ep_len_mean           | 1.52e+04  |
|    ep_rew_mean           | -389      |
|    exploration_rate      | 0.135     |
| time/                    |           |
|    episodes              | 3         |
|    fps                   | 2527      |
|    time_elapsed          | 18        |
|    total_timesteps       | 45544     |
----------------------------------------
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -216.9652
Episode PnL: -4.03%
Trade Count: 1366
Average PnL per Trade: -0.0295%
Total # of episodes: 4
short_inventory_market_orders	=	195
short_inventory_orders_placed	=	532
short_inventory_orders_updated	=	6133
short_inventory_orders_executed	=	531
long_inventory_market_orders	=	152
long_inventory_orders_placed	=	489
long_inventory_orders_updated	=	6003
long_inventory_orders_executed	=	488
First step:	144
===========================================================================
----------------------------------------
| logger/                  |           |
|    episode_avg_trade_pnl | -0.000299 |
|    episode_pnl           | -4.06     |
|    episode_reward        | -216      |
| rollout/                 |           |
|    ep_len_mean           | 1.53e+04  |
|    ep_rew_mean           | -346      |
|    exploration_rate      | 0.05      |
| time/                    |           |
|    episodes              | 4         |
|    fps                   | 1726      |
|    time_elapsed          | 35        |
|    total_timesteps       | 61051     |
| train/                   |           |
|    learning_rate         | 0.0001    |
|    loss                  | 0.0144    |
|    n_updates             | 2762      |
----------------------------------------
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -145.9545
Episode PnL: -3.62%
Trade Count: 1196
Average PnL per Trade: -0.0303%
Total # of episodes: 5
short_inventory_market_orders	=	129
short_inventory_orders_placed	=	520
short_inventory_orders_updated	=	4343
short_inventory_orders_executed	=	519
long_inventory_market_orders	=	79
long_inventory_orders_placed	=	470
long_inventory_orders_updated	=	4777
long_inventory_orders_executed	=	469
First step:	16332
===========================================================================
----------------------------------------
| logger/                  |           |
|    episode_avg_trade_pnl | -0.000305 |
|    episode_pnl           | -3.62     |
|    episode_reward        | -145      |
| rollout/                 |           |
|    ep_len_mean           | 1.56e+04  |
|    ep_rew_mean           | -306      |
|    exploration_rate      | 0.05      |
| time/                    |           |
|    episodes              | 5         |
|    fps                   | 1312      |
|    time_elapsed          | 59        |
|    total_timesteps       | 78092     |
| train/                   |           |
|    learning_rate         | 0.0001    |
|    loss                  | 0.00404   |
|    n_updates             | 7022      |
----------------------------------------
[2023-05-22 09:42:33,417, broker.py:207] WARNING: Long and Short orders filled in the same step
[2023-05-22 09:42:33,417, broker.py:208] bid=7160.0 | ask=7170.0 | buy_vol=73270.0 | sell_vol=36592.0 | step=20615
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -152.9484
Episode PnL: -1.12%
Trade Count: 1138
Average PnL per Trade: -0.0098%
Total # of episodes: 6
short_inventory_market_orders	=	101
short_inventory_orders_placed	=	454
short_inventory_orders_updated	=	4041
short_inventory_orders_executed	=	453
long_inventory_market_orders	=	116
long_inventory_orders_placed	=	469
long_inventory_orders_updated	=	3967
long_inventory_orders_executed	=	468
First step:	7751
===========================================================================
---------------------------------------
| logger/                  |          |
|    episode_avg_trade_pnl | -9.2e-05 |
|    episode_pnl           | -1.04    |
|    episode_reward        | -152     |
| rollout/                 |          |
|    ep_len_mean           | 1.53e+04 |
|    ep_rew_mean           | -280     |
|    exploration_rate      | 0.05     |
| time/                    |          |
|    episodes              | 6        |
|    fps                   | 1124     |
|    time_elapsed          | 81       |
|    total_timesteps       | 91895    |
| train/                   |          |
|    learning_rate         | 0.0001   |
|    loss                  | 0.00444  |
|    n_updates             | 10473    |
---------------------------------------
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -121.9633
Episode PnL: -1.15%
Trade Count: 1376
Average PnL per Trade: -0.0084%
Total # of episodes: 7
short_inventory_market_orders	=	219
short_inventory_orders_placed	=	611
short_inventory_orders_updated	=	4060
short_inventory_orders_executed	=	610
long_inventory_market_orders	=	78
long_inventory_orders_placed	=	470
long_inventory_orders_updated	=	4519
long_inventory_orders_executed	=	469
First step:	10989
===========================================================================
----------------------------------------
| logger/                  |           |
|    episode_avg_trade_pnl | -7.12e-05 |
|    episode_pnl           | -0.974    |
|    episode_reward        | -121      |
| rollout/                 |           |
|    ep_len_mean           | 1.53e+04  |
|    ep_rew_mean           | -258      |
|    exploration_rate      | 0.05      |
| time/                    |           |
|    episodes              | 7         |
|    fps                   | 1030      |
|    time_elapsed          | 104       |
|    total_timesteps       | 107414    |
| train/                   |           |
|    learning_rate         | 0.0001    |
|    loss                  | 0.0029    |
|    n_updates             | 14353     |
----------------------------------------
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -111.9512
Episode PnL: -1.45%
Trade Count: 1136
Average PnL per Trade: -0.0128%
Total # of episodes: 8
short_inventory_market_orders	=	101
short_inventory_orders_placed	=	470
short_inventory_orders_updated	=	4306
short_inventory_orders_executed	=	469
long_inventory_market_orders	=	99
long_inventory_orders_placed	=	468
long_inventory_orders_updated	=	4008
long_inventory_orders_executed	=	467
First step:	3462
===========================================================================
----------------------------------------
| logger/                  |           |
|    episode_avg_trade_pnl | -0.000137 |
|    episode_pnl           | -1.55     |
|    episode_reward        | -113      |
| rollout/                 |           |
|    ep_len_mean           | 1.53e+04  |
|    ep_rew_mean           | -239      |
|    exploration_rate      | 0.05      |
| time/                    |           |
|    episodes              | 8         |
|    fps                   | 958       |
|    time_elapsed          | 127       |
|    total_timesteps       | 122286    |
| train/                   |           |
|    learning_rate         | 0.0001    |
|    loss                  | 0.0163    |
|    n_updates             | 18071     |
----------------------------------------
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -98.9464
Episode PnL: -2.97%
Trade Count: 1172
Average PnL per Trade: -0.0253%
Total # of episodes: 9
short_inventory_market_orders	=	145
short_inventory_orders_placed	=	512
short_inventory_orders_updated	=	4185
short_inventory_orders_executed	=	511
long_inventory_market_orders	=	75
long_inventory_orders_placed	=	442
long_inventory_orders_updated	=	4454
long_inventory_orders_executed	=	441
First step:	12645
===========================================================================
----------------------------------------
| logger/                  |           |
|    episode_avg_trade_pnl | -0.000257 |
|    episode_pnl           | -3        |
|    episode_reward        | -99.9     |
| rollout/                 |           |
|    ep_len_mean           | 1.54e+04  |
|    ep_rew_mean           | -224      |
|    exploration_rate      | 0.05      |
| time/                    |           |
|    episodes              | 9         |
|    fps                   | 906       |
|    time_elapsed          | 152       |
|    total_timesteps       | 138663    |
| train/                   |           |
|    learning_rate         | 0.0001    |
|    loss                  | 0.00243   |
|    n_updates             | 22165     |
----------------------------------------
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -131.9584
Episode PnL: -3.25%
Trade Count: 1200
Average PnL per Trade: -0.0271%
Total # of episodes: 10
short_inventory_market_orders	=	153
short_inventory_orders_placed	=	518
short_inventory_orders_updated	=	3778
short_inventory_orders_executed	=	517
long_inventory_market_orders	=	83
long_inventory_orders_placed	=	448
long_inventory_orders_updated	=	3993
long_inventory_orders_executed	=	447
First step:	2962
===========================================================================
----------------------------------------
| logger/                  |           |
|    episode_avg_trade_pnl | -0.000271 |
|    episode_pnl           | -3.25     |
|    episode_reward        | -131      |
| rollout/                 |           |
|    ep_len_mean           | 1.53e+04  |
|    ep_rew_mean           | -215      |
|    exploration_rate      | 0.05      |
| time/                    |           |
|    episodes              | 10        |
|    fps                   | 864       |
|    time_elapsed          | 177       |
|    total_timesteps       | 153203    |
| train/                   |           |
|    learning_rate         | 0.0001    |
|    loss                  | 0.0017    |
|    n_updates             | 25800     |
----------------------------------------
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -114.9546
Episode PnL: -3.78%
Trade Count: 1230
Average PnL per Trade: -0.0307%
Total # of episodes: 11
short_inventory_market_orders	=	112
short_inventory_orders_placed	=	518
short_inventory_orders_updated	=	4547
short_inventory_orders_executed	=	517
long_inventory_market_orders	=	98
long_inventory_orders_placed	=	504
long_inventory_orders_updated	=	4409
long_inventory_orders_executed	=	503
First step:	8444
===========================================================================
----------------------------------------
| logger/                  |           |
|    episode_avg_trade_pnl | -0.000308 |
|    episode_pnl           | -3.78     |
|    episode_reward        | -114      |
| rollout/                 |           |
|    ep_len_mean           | 1.54e+04  |
|    ep_rew_mean           | -206      |
|    exploration_rate      | 0.05      |
| time/                    |           |
|    episodes              | 11        |
|    fps                   | 827       |
|    time_elapsed          | 205       |
|    total_timesteps       | 169680    |
| train/                   |           |
|    learning_rate         | 0.0001    |
|    loss                  | 0.00167   |
|    n_updates             | 29919     |
----------------------------------------
[2023-05-22 09:45:02,518, broker.py:207] WARNING: Long and Short orders filled in the same step
[2023-05-22 09:45:02,519, broker.py:208] bid=7087.5 | ask=7093.0 | buy_vol=213532.0 | sell_vol=895804.0 | step=20591
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -132.9654
Episode PnL: -2.46%
Trade Count: 1326
Average PnL per Trade: -0.0185%
Total # of episodes: 12
short_inventory_market_orders	=	172
short_inventory_orders_placed	=	532
short_inventory_orders_updated	=	4065
short_inventory_orders_executed	=	531
long_inventory_market_orders	=	132
long_inventory_orders_placed	=	492
long_inventory_orders_updated	=	4103
long_inventory_orders_executed	=	491
First step:	4764
===========================================================================
---------------------------------------
| logger/                  |          |
|    episode_avg_trade_pnl | -0.00019 |
|    episode_pnl           | -2.5     |
|    episode_reward        | -132     |
| rollout/                 |          |
|    ep_len_mean           | 1.54e+04 |
|    ep_rew_mean           | -200     |
|    exploration_rate      | 0.05     |
| time/                    |          |
|    episodes              | 12       |
|    fps                   | 802      |
|    time_elapsed          | 230      |
|    total_timesteps       | 185061   |
| train/                   |          |
|    learning_rate         | 0.0001   |
|    loss                  | 0.0261   |
|    n_updates             | 33765    |
---------------------------------------
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -162.9657
Episode PnL: -6.58%
Trade Count: 1238
Average PnL per Trade: -0.0532%
Total # of episodes: 13
short_inventory_market_orders	=	136
short_inventory_orders_placed	=	448
short_inventory_orders_updated	=	4435
short_inventory_orders_executed	=	447
long_inventory_market_orders	=	172
long_inventory_orders_placed	=	484
long_inventory_orders_updated	=	4504
long_inventory_orders_executed	=	483
First step:	16946
===========================================================================
----------------------------------------
| logger/                  |           |
|    episode_avg_trade_pnl | -0.000524 |
|    episode_pnl           | -6.44     |
|    episode_reward        | -162      |
| rollout/                 |           |
|    ep_len_mean           | 1.55e+04  |
|    ep_rew_mean           | -197      |
|    exploration_rate      | 0.05      |
| time/                    |           |
|    episodes              | 13        |
|    fps                   | 785       |
|    time_elapsed          | 256       |
|    total_timesteps       | 201178    |
| train/                   |           |
|    learning_rate         | 0.0001    |
|    loss                  | 0.00763   |
|    n_updates             | 37794     |
----------------------------------------
Traceback (most recent call last):
  File "agent/sb3.py", line 102, in <module>
    model.learn(
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/stable_baselines3/dqn/dqn.py", line 269, in learn
    return super().learn(
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/stable_baselines3/common/off_policy_algorithm.py", line 330, in learn
    self.train(batch_size=self.batch_size, gradient_steps=gradient_steps)
KeyboardInterrupt