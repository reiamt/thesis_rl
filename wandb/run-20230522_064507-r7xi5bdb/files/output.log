
[2023-05-22 06:45:10,841, ema.py:67] EMA smoothing ENABLED: 0.99
[2023-05-22 06:45:13,865, data_pipeline.py:49] Imported 101_20200102_merge.csv.xz from a csv in 3 seconds
[2023-05-22 06:45:14,348, ema.py:93] Applying EMA to data...
[2023-05-22 06:45:16,594, data_pipeline.py:49] Imported /XBTUSD_2020-01-03.csv.xz from a csv in 1 seconds
[2023-05-22 06:45:16,840, ema.py:93] Applying EMA to data...
[2023-05-22 06:45:17,097, data_pipeline.py:228] Adding order imbalances...
[2023-05-22 06:45:17,118, ema.py:127] Reset EMA data.
[2023-05-22 06:45:17,119, ema.py:93] Applying EMA to data...
[2023-05-22 06:45:17,311, ema.py:67] EMA smoothing ENABLED: 0.99
[2023-05-22 06:45:17,311, ema.py:67] EMA smoothing ENABLED: 0.99
[2023-05-22 06:45:17,311, ema.py:67] EMA smoothing ENABLED: 0.99
[2023-05-22 06:45:17,311, ema.py:67] EMA smoothing ENABLED: 0.99
Resetting environment #1 on episode #0.
market-maker-v0 XBTUSD #1 instantiated
observation_space: (100, 174) reward_type = TRADE_COMPLETION max_steps = 86345
Using cpu device
Resetting environment #1 on episode #0.
Logging to ./runs/r7xi5bdb/DQN_1
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -393.9879
Episode PnL: -1.81%
Trade Count: 1796
Average PnL per Trade: -0.0101%
Total # of episodes: 1
short_inventory_market_orders	=	368
short_inventory_orders_placed	=	581
short_inventory_orders_updated	=	9876
short_inventory_orders_executed	=	580
long_inventory_market_orders	=	318
long_inventory_orders_placed	=	531
long_inventory_orders_updated	=	9844
long_inventory_orders_executed	=	530
First step:	5192
===========================================================================
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -399.9870
Episode PnL: -0.81%
Trade Count: 1844
Average PnL per Trade: -0.0044%
Total # of episodes: 2
short_inventory_market_orders	=	360
short_inventory_orders_placed	=	613
short_inventory_orders_updated	=	10706
short_inventory_orders_executed	=	612
long_inventory_market_orders	=	310
long_inventory_orders_placed	=	563
long_inventory_orders_updated	=	10830
long_inventory_orders_executed	=	562
First step:	10955
===========================================================================
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -413.9889
Episode PnL: -4.68%
Trade Count: 1748
Average PnL per Trade: -0.0267%
Total # of episodes: 3
short_inventory_market_orders	=	334
short_inventory_orders_placed	=	563
short_inventory_orders_updated	=	10033
short_inventory_orders_executed	=	562
long_inventory_market_orders	=	312
long_inventory_orders_placed	=	541
long_inventory_orders_updated	=	10109
long_inventory_orders_executed	=	540
First step:	7813
===========================================================================
[2023-05-22 06:45:48,518, broker.py:207] WARNING: Long and Short orders filled in the same step
[2023-05-22 06:45:48,519, broker.py:208] bid=7289.0 | ask=7292.5 | buy_vol=21614.0 | sell_vol=1782966.0 | step=72566
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -222.9678
Episode PnL: -2.75%
Trade Count: 1482
Average PnL per Trade: -0.0185%
Total # of episodes: 4
short_inventory_market_orders	=	219
short_inventory_orders_placed	=	598
short_inventory_orders_updated	=	6278
short_inventory_orders_executed	=	597
long_inventory_market_orders	=	144
long_inventory_orders_placed	=	523
long_inventory_orders_updated	=	6374
long_inventory_orders_executed	=	522
First step:	144
===========================================================================
----------------------------------
| logger/             |          |
|    reward           | 2.4e-11  |
| rollout/            |          |
|    ep_len_mean      | 1.53e+04 |
|    ep_rew_mean      | -358     |
|    exploration_rate | 0.05     |
| time/               |          |
|    episodes         | 4        |
|    fps              | 1728     |
|    time_elapsed     | 35       |
|    total_timesteps  | 61051    |
| train/              |          |
|    learning_rate    | 0.0001   |
|    loss             | 0.00405  |
|    n_updates        | 2762     |
----------------------------------
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -106.9448
Episode PnL: -0.57%
Trade Count: 1296
Average PnL per Trade: -0.0044%
Total # of episodes: 5
short_inventory_market_orders	=	81
short_inventory_orders_placed	=	531
short_inventory_orders_updated	=	4933
short_inventory_orders_executed	=	530
long_inventory_market_orders	=	118
long_inventory_orders_placed	=	568
long_inventory_orders_updated	=	4872
long_inventory_orders_executed	=	567
First step:	16332
===========================================================================
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -116.9498
Episode PnL: -2.28%
Trade Count: 1236
Average PnL per Trade: -0.0185%
Total # of episodes: 6
short_inventory_market_orders	=	103
short_inventory_orders_placed	=	517
short_inventory_orders_updated	=	4154
short_inventory_orders_executed	=	516
long_inventory_market_orders	=	102
long_inventory_orders_placed	=	516
long_inventory_orders_updated	=	4291
long_inventory_orders_executed	=	515
First step:	7751
===========================================================================
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -143.9687
Episode PnL: -3.34%
Trade Count: 1248
Average PnL per Trade: -0.0267%
Total # of episodes: 7
short_inventory_market_orders	=	143
short_inventory_orders_placed	=	508
short_inventory_orders_updated	=	4397
short_inventory_orders_executed	=	507
long_inventory_market_orders	=	117
long_inventory_orders_placed	=	482
long_inventory_orders_updated	=	4786
long_inventory_orders_executed	=	481
First step:	10989
===========================================================================
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -142.9537
Episode PnL: -0.70%
Trade Count: 1260
Average PnL per Trade: -0.0055%
Total # of episodes: 8
short_inventory_market_orders	=	128
short_inventory_orders_placed	=	449
short_inventory_orders_updated	=	4315
short_inventory_orders_executed	=	448
long_inventory_market_orders	=	182
long_inventory_orders_placed	=	503
long_inventory_orders_updated	=	4228
long_inventory_orders_executed	=	502
First step:	3462
===========================================================================
----------------------------------
| logger/             |          |
|    reward           | 2.4e-11  |
| rollout/            |          |
|    ep_len_mean      | 1.53e+04 |
|    ep_rew_mean      | -243     |
|    exploration_rate | 0.05     |
| time/               |          |
|    episodes         | 8        |
|    fps              | 965      |
|    time_elapsed     | 126      |
|    total_timesteps  | 122286   |
| train/              |          |
|    learning_rate    | 0.0001   |
|    loss             | 0.00247  |
|    n_updates        | 18071    |
----------------------------------
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -155.9558
Episode PnL: -3.02%
Trade Count: 1238
Average PnL per Trade: -0.0244%
Total # of episodes: 9
short_inventory_market_orders	=	79
short_inventory_orders_placed	=	473
short_inventory_orders_updated	=	4610
short_inventory_orders_executed	=	472
long_inventory_market_orders	=	147
long_inventory_orders_placed	=	541
long_inventory_orders_updated	=	4670
long_inventory_orders_executed	=	540
First step:	12645
===========================================================================
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -87.9582
Episode PnL: -0.98%
Trade Count: 1146
Average PnL per Trade: -0.0085%
Total # of episodes: 10
short_inventory_market_orders	=	75
short_inventory_orders_placed	=	425
short_inventory_orders_updated	=	4346
short_inventory_orders_executed	=	424
long_inventory_market_orders	=	149
long_inventory_orders_placed	=	498
long_inventory_orders_updated	=	4166
long_inventory_orders_executed	=	498
First step:	2962
===========================================================================
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -103.9486
Episode PnL: -1.39%
Trade Count: 1252
Average PnL per Trade: -0.0111%
Total # of episodes: 11
short_inventory_market_orders	=	99
short_inventory_orders_placed	=	479
short_inventory_orders_updated	=	4449
short_inventory_orders_executed	=	478
long_inventory_market_orders	=	148
long_inventory_orders_placed	=	528
long_inventory_orders_updated	=	4364
long_inventory_orders_executed	=	527
First step:	8444
===========================================================================
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -108.9463
Episode PnL: -2.52%
Trade Count: 1296
Average PnL per Trade: -0.0195%
Total # of episodes: 12
short_inventory_market_orders	=	84
short_inventory_orders_placed	=	545
short_inventory_orders_updated	=	4303
short_inventory_orders_executed	=	544
long_inventory_market_orders	=	104
long_inventory_orders_placed	=	565
long_inventory_orders_updated	=	4167
long_inventory_orders_executed	=	564
First step:	4764
===========================================================================
----------------------------------
| logger/             |          |
|    reward           | 2.4e-11  |
| rollout/            |          |
|    ep_len_mean      | 1.54e+04 |
|    ep_rew_mean      | -200     |
|    exploration_rate | 0.05     |
| time/               |          |
|    episodes         | 12       |
|    fps              | 831      |
|    time_elapsed     | 222      |
|    total_timesteps  | 185061   |
| train/              |          |
|    learning_rate    | 0.0001   |
|    loss             | 0.00174  |
|    n_updates        | 33765    |
----------------------------------
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -129.9710
Episode PnL: -2.95%
Trade Count: 1274
Average PnL per Trade: -0.0232%
Total # of episodes: 13
short_inventory_market_orders	=	153
short_inventory_orders_placed	=	443
short_inventory_orders_updated	=	4590
short_inventory_orders_executed	=	442
long_inventory_market_orders	=	195
long_inventory_orders_placed	=	485
long_inventory_orders_updated	=	4492
long_inventory_orders_executed	=	484
First step:	16946
===========================================================================
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -114.9606
Episode PnL: -0.70%
Trade Count: 1156
Average PnL per Trade: -0.0061%
Total # of episodes: 14
short_inventory_market_orders	=	116
short_inventory_orders_placed	=	493
short_inventory_orders_updated	=	4089
short_inventory_orders_executed	=	492
long_inventory_market_orders	=	86
long_inventory_orders_placed	=	463
long_inventory_orders_updated	=	4339
long_inventory_orders_executed	=	462
First step:	17137
===========================================================================
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -129.9870
Episode PnL: -4.08%
Trade Count: 1052
Average PnL per Trade: -0.0387%
Total # of episodes: 15
short_inventory_market_orders	=	116
short_inventory_orders_placed	=	398
short_inventory_orders_updated	=	4198
short_inventory_orders_executed	=	398
long_inventory_market_orders	=	128
long_inventory_orders_placed	=	411
long_inventory_orders_updated	=	3761
long_inventory_orders_executed	=	410
First step:	11742
===========================================================================
Traceback (most recent call last):
  File "agent/sb3.py", line 80, in <module>
    model.learn(
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/stable_baselines3/dqn/dqn.py", line 269, in learn
    return super().learn(
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/stable_baselines3/common/off_policy_algorithm.py", line 330, in learn
    self.train(batch_size=self.batch_size, gradient_steps=gradient_steps)
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/stable_baselines3/dqn/dqn.py", line 222, in train
    self.policy.optimizer.step()
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/torch/optim/optimizer.py", line 280, in wrapper
    out = func(*args, **kwargs)
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/torch/optim/optimizer.py", line 33, in _use_grad
    ret = func(self, *args, **kwargs)
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/torch/optim/adam.py", line 141, in step
    adam(
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/torch/optim/adam.py", line 281, in adam
    func(params,
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/torch/optim/adam.py", line 345, in _single_tensor_adam
    exp_avg_sq.mul_(beta2).addcmul_(grad, grad.conj(), value=1 - beta2)
KeyboardInterrupt