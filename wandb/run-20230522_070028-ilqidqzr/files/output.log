
[2023-05-22 07:00:32,534, ema.py:67] EMA smoothing ENABLED: 0.99
[2023-05-22 07:00:35,412, data_pipeline.py:49] Imported 101_20200102_merge.csv.xz from a csv in 2 seconds
[2023-05-22 07:00:35,640, ema.py:93] Applying EMA to data...
[2023-05-22 07:00:37,846, data_pipeline.py:49] Imported /XBTUSD_2020-01-03.csv.xz from a csv in 1 seconds
[2023-05-22 07:00:38,017, ema.py:93] Applying EMA to data...
[2023-05-22 07:00:38,249, data_pipeline.py:228] Adding order imbalances...
[2023-05-22 07:00:38,273, ema.py:127] Reset EMA data.
[2023-05-22 07:00:38,273, ema.py:93] Applying EMA to data...
Resetting environment #1 on episode #0.
market-maker-v0 XBTUSD #1 instantiated
observation_space: (100, 174) reward_type = TRADE_COMPLETION max_steps = 86345
Using cpu device
Resetting environment #1 on episode #0.
Logging to ./runs/ilqidqzr/DQN_1
[2023-05-22 07:00:38,494, ema.py:67] EMA smoothing ENABLED: 0.99
[2023-05-22 07:00:38,494, ema.py:67] EMA smoothing ENABLED: 0.99
[2023-05-22 07:00:38,494, ema.py:67] EMA smoothing ENABLED: 0.99
[2023-05-22 07:00:38,494, ema.py:67] EMA smoothing ENABLED: 0.99
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -374.9842
Episode PnL: -2.46%
Trade Count: 1720
Average PnL per Trade: -0.0143%
Total # of episodes: 1
short_inventory_market_orders	=	342
short_inventory_orders_placed	=	572
short_inventory_orders_updated	=	9742
short_inventory_orders_executed	=	571
long_inventory_market_orders	=	289
long_inventory_orders_placed	=	519
long_inventory_orders_updated	=	9750
long_inventory_orders_executed	=	518
First step:	5192
===========================================================================
[2023-05-22 07:00:45,202, broker.py:207] WARNING: Long and Short orders filled in the same step
[2023-05-22 07:00:45,203, broker.py:208] bid=7160.0 | ask=7170.0 | buy_vol=73270.0 | sell_vol=36592.0 | step=20615
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -375.9830
Episode PnL: -2.00%
Trade Count: 1804
Average PnL per Trade: -0.0111%
Total # of episodes: 2
short_inventory_market_orders	=	376
short_inventory_orders_placed	=	632
short_inventory_orders_updated	=	10779
short_inventory_orders_executed	=	631
long_inventory_market_orders	=	271
long_inventory_orders_placed	=	527
long_inventory_orders_updated	=	10863
long_inventory_orders_executed	=	526
First step:	10955
===========================================================================
[2023-05-22 07:00:50,546, broker.py:207] WARNING: Long and Short orders filled in the same step
[2023-05-22 07:00:50,546, broker.py:208] bid=7092.5 | ask=7100.0 | buy_vol=1190267.0 | sell_vol=1250607.0 | step=20587
[2023-05-22 07:00:50,549, broker.py:207] WARNING: Long and Short orders filled in the same step
[2023-05-22 07:00:50,549, broker.py:208] bid=7189.5 | ask=7200.0 | buy_vol=3452931.0 | sell_vol=47400.0 | step=20622
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -409.9921
Episode PnL: -2.38%
Trade Count: 1768
Average PnL per Trade: -0.0134%
Total # of episodes: 3
short_inventory_market_orders	=	346
short_inventory_orders_placed	=	594
short_inventory_orders_updated	=	9982
short_inventory_orders_executed	=	593
long_inventory_market_orders	=	291
long_inventory_orders_placed	=	539
long_inventory_orders_updated	=	10033
long_inventory_orders_executed	=	538
First step:	7813
===========================================================================
[2023-05-22 07:00:56,005, broker.py:207] WARNING: Long and Short orders filled in the same step
[2023-05-22 07:00:56,005, broker.py:208] bid=7136.5 | ask=7145.5 | buy_vol=1576534.0 | sell_vol=1101400.0 | step=20610
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -191.9525
Episode PnL: -2.46%
Trade Count: 1448
Average PnL per Trade: -0.0170%
Total # of episodes: 4
short_inventory_market_orders	=	249
short_inventory_orders_placed	=	586
short_inventory_orders_updated	=	6025
short_inventory_orders_executed	=	585
long_inventory_market_orders	=	139
long_inventory_orders_placed	=	476
long_inventory_orders_updated	=	6421
long_inventory_orders_executed	=	475
First step:	144
===========================================================================
----------------------------------
| logger/             |          |
|    tb_logging       | 6e-12    |
| rollout/            |          |
|    ep_len_mean      | 1.53e+04 |
|    ep_rew_mean      | -338     |
|    exploration_rate | 0.05     |
| time/               |          |
|    episodes         | 4        |
|    fps              | 1701     |
|    time_elapsed     | 35       |
|    total_timesteps  | 61051    |
| train/              |          |
|    learning_rate    | 0.0001   |
|    loss             | 0.00127  |
|    n_updates        | 2762     |
----------------------------------
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -140.9521
Episode PnL: -3.54%
Trade Count: 1382
Average PnL per Trade: -0.0256%
Total # of episodes: 5
short_inventory_market_orders	=	85
short_inventory_orders_placed	=	453
short_inventory_orders_updated	=	4591
short_inventory_orders_executed	=	452
long_inventory_market_orders	=	239
long_inventory_orders_placed	=	607
long_inventory_orders_updated	=	4459
long_inventory_orders_executed	=	606
First step:	16332
===========================================================================
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -109.9640
Episode PnL: -0.56%
Trade Count: 1068
Average PnL per Trade: -0.0052%
Total # of episodes: 6
short_inventory_market_orders	=	123
short_inventory_orders_placed	=	465
short_inventory_orders_updated	=	3740
short_inventory_orders_executed	=	464
long_inventory_market_orders	=	70
long_inventory_orders_placed	=	412
long_inventory_orders_updated	=	4058
long_inventory_orders_executed	=	411
First step:	7751
===========================================================================
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -157.9672
Episode PnL: -3.60%
Trade Count: 1264
Average PnL per Trade: -0.0285%
Total # of episodes: 7
short_inventory_market_orders	=	107
short_inventory_orders_placed	=	502
short_inventory_orders_updated	=	4257
short_inventory_orders_executed	=	501
long_inventory_market_orders	=	131
long_inventory_orders_placed	=	526
long_inventory_orders_updated	=	4240
long_inventory_orders_executed	=	525
First step:	10989
===========================================================================
------------------------- XBTUSD-1 TRADE_COMPLETION EPISODE RESET -------------------------
Episode Reward: -104.9598
Episode PnL: -3.72%
Trade Count: 1102
Average PnL per Trade: -0.0338%
Total # of episodes: 8
short_inventory_market_orders	=	149
short_inventory_orders_placed	=	461
short_inventory_orders_updated	=	3997
short_inventory_orders_executed	=	460
long_inventory_market_orders	=	91
long_inventory_orders_placed	=	403
long_inventory_orders_updated	=	4009
long_inventory_orders_executed	=	402
First step:	3462
===========================================================================
----------------------------------
| logger/             |          |
|    tb_logging       | 6e-12    |
| rollout/            |          |
|    ep_len_mean      | 1.53e+04 |
|    ep_rew_mean      | -233     |
|    exploration_rate | 0.05     |
| time/               |          |
|    episodes         | 8        |
|    fps              | 940      |
|    time_elapsed     | 129      |
|    total_timesteps  | 122286   |
| train/              |          |
|    learning_rate    | 0.0001   |
|    loss             | 0.012    |
|    n_updates        | 18071    |
----------------------------------
Traceback (most recent call last):
  File "agent/sb3.py", line 82, in <module>
    model.learn(
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/stable_baselines3/dqn/dqn.py", line 269, in learn
    return super().learn(
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/stable_baselines3/common/off_policy_algorithm.py", line 330, in learn
    self.train(batch_size=self.batch_size, gradient_steps=gradient_steps)
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/stable_baselines3/dqn/dqn.py", line 222, in train
    self.policy.optimizer.step()
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/torch/optim/optimizer.py", line 280, in wrapper
    out = func(*args, **kwargs)
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/torch/optim/optimizer.py", line 33, in _use_grad
    ret = func(self, *args, **kwargs)
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/torch/optim/adam.py", line 141, in step
    adam(
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/torch/optim/adam.py", line 281, in adam
    func(params,
  File "/Users/tam/miniconda3/envs/thesis/lib/python3.8/site-packages/torch/optim/adam.py", line 345, in _single_tensor_adam
    exp_avg_sq.mul_(beta2).addcmul_(grad, grad.conj(), value=1 - beta2)
KeyboardInterrupt